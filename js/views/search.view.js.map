{"version":3,"sources":["views/search.view.js"],"names":[],"mappings":"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","file":"views/search.view.js","sourcesContent":["define([\n\t\t'backbone',\n\t\t'tmpls',\n\n\t\t'entities/worker',\n\t\t'utils/indexer',\n\t\t'views/suggestions.view',\n\t\t'views/indexation.view',\n\t\t'views/results.view'\n\t],\n\tfunction (Backbone, tmpls, worker, indexer, SuggestionsView, IndexationView, ResultsView) {\n\t\tconst SUGGESTIONS_COUNT = 5;\n\t\tconst MIN_QUERY_LEN_FOR_SUGGESTION = 3;\n\n\t\treturn Backbone.View.extend({\n\t\t\ttagName: 'form',\n\n\t\t\tid: 'search-widget',\n\n\t\t\ttemplate: tmpls.search,\n\n\t\t\tevents: {\n\t\t\t\t'submit': 'submit',\n\t\t\t\t'input': 'input',\n\t\t\t\t'click #clear': 'clear'\n\t\t\t},\n\n\t\t\tinitialize: function () {\n\t\t\t\tworker.addEventListener('message', this.message.bind(this));\n\n\t\t\t\t// auto-render\n\t\t\t\tthis.render();\n\n\t\t\t\tthis.indexationView = new IndexationView();\n\t\t\t\tthis.indexationView.render().$el.prependTo('body');\n\t\t\t},\n\n\t\t\tclear: function () {\n\t\t\t\tthis.el.reset();\n\n\t\t\t\t// untarget\n\t\t\t\tlocation.hash = '';\n\t\t\t},\n\n\t\t\tsubmit: function (e) {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tthis._clearSuggestions();\n\n\t\t\t\tworker.postMessage({\n\t\t\t\t\ttype: 'search',\n\t\t\t\t\tevent: 'searched',\n\t\t\t\t\ttext: e.target.querySelector('input').value\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tinput: function (e) {\n\t\t\t\tthis._clearResults();\n\t\t\t\tthis._clearSuggestions();\n\n\t\t\t\tvar query = e.target.value;\n\n\t\t\t\tif (query.trim().length < MIN_QUERY_LEN_FOR_SUGGESTION) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tworker.postMessage({\n\t\t\t\t\ttype: 'search',\n\t\t\t\t\tevent: 'suggested',\n\t\t\t\t\ttext: query\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tmessage: function (e) {\n\t\t\t\tswitch (e.data.type) {\n\t\t\t\t\tcase 'ready':\n\t\t\t\t\t\tthis._startIndexing();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'suggested':\n\t\t\t\t\t\tthis._attachSuggestions(e.data);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'searched':\n\t\t\t\t\t\tthis._attachSearchResults(e.data);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'indexed':\n\t\t\t\t\t\tthis._markIndexed();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\trender: function () {\n\t\t\t\tthis.$el\n\t\t\t\t\t.html(this.template());\n\n\t\t\t\treturn this;\n\t\t\t},\n\n\t\t\t/* ----- */\n\n\t\t\tshow: function () {\n\t\t\t\tthis.$el.show().find('input').focus();\n\t\t\t},\n\n\t\t\thide: function () {\n\t\t\t\tthis.$el.hide().find('input').val('');\n\n\t\t\t\tthis._clearResults();\n\t\t\t\tthis._clearSuggestions();\n\t\t\t},\n\n\t\t\t/* ----- */\n\n\t\t\t_attachSearchResults: function (data) {\n\t\t\t\tthis._clearResults();\n\n\t\t\t\tvar results = new ResultsView(data);\n\n\t\t\t\tresults.$el.appendTo('#results');\n\t\t\t},\n\n\t\t\t_clearResults: function () {\n\t\t\t\tthis.$('#results').empty();\n\t\t\t},\n\n\t\t\t/* ----- */\n\n\t\t\t_attachSuggestions: function (data) {\n\t\t\t\tthis._clearSuggestions();\n\n\t\t\t\tvar suggestions = new SuggestionsView({\n\t\t\t\t\tresults: data.results.slice(0, SUGGESTIONS_COUNT),\n\t\t\t\t\twords: data.words,\n\t\t\t\t\tquery: data.query\n\t\t\t\t});\n\n\t\t\t\tsuggestions.render().$el.appendTo('#suggestions');\n\t\t\t},\n\n\t\t\t_clearSuggestions: function () {\n\t\t\t\tthis.$('#suggestions').empty();\n\t\t\t},\n\n\t\t\t/* ----- */\n\n\t\t\t_startIndexing: function () {\n\t\t\t\tworker.postMessage({\n\t\t\t\t\ttype: 'index',\n\t\t\t\t\tarray: indexer('#content')\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t_markIndexed: function () {\n\t\t\t\tthis.indexationView.$el.remove();\n\t\t\t}\n\t\t});\n\t});"],"sourceRoot":"/source/"}